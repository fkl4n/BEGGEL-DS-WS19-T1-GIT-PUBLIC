---
title: "CommitOverTime"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

# Load Libraries
```{r,  warning=FALSE,include= TRUE,echo=TRUE,results='hide', message=FALSE}
#install.packages("dplyr")
#install.packages("stringr")
#nstall.packages(graphics)
#install.packages("lubridate")
# load installed libraries 
library(dplyr)
library(stringr)
library(graphics)
library(ggplot2)
library(lubridate)

```
Festlegen des Arbeitsverzeichnisses und der Zeitspanne
```{r}

setwd("/Users/mathiasfedder/git/BEGGEL-DS-WS19-T1-GIT/")
timeframe <- c(as.Date("1997-01-01"),as.Date("2019-12-31"))

```

# PostgreSQL 
Einlesen der Daten aus dem CSV sowie umwandeln der Zeitdaten in ein R Zeitformat
```{r}
#Load function to import db_history .csv file
#usage: load_db_history("path")
source("../csv_file_import/load_db_history.R")
db_git_history_Postgre = load_db_history(input_path = "../../Workspace/PostgreSQL.csv")
db_git_history_Postgre["timestamp"] = lapply(db_git_history_Postgre["timestamp"],function(x) as.Date(x, format='%Y-%m-%d') )

```

Gruppiert nach Datum werden die eindeutigen CommitIds für diesen Tag aufsummiert
```{r}

extractedTable_Postgre <- db_git_history_Postgre %>%
  group_by(timestamp) %>%
	summarise(commitCount = n_distinct(commit))

```

Erster Plot zum Überblick
```{r}

PostgrePlot <-ggplot(extractedTable_Postgre, aes(y=commitCount,x=timestamp)) + geom_line(color = "green") +stat_smooth(
  color = "#FC4E07", fill = "#FC4E07",
  method = "loess"
  )+ggtitle("Commit over Time") +
            xlab("Date") + ylab("CommitCount") + scale_x_date(limit=timeframe) 

```

Hier lässt sich erkennen das zu beginn der erstellung des Repository zunächst viel Code Produziert wird, anschließend fällt die Commitanzahl leicht ab um dann wieder leicht anzusteigen. 
```{r}

PostgrePlot

```

Erzeugen einer extra Spalte für Monat und Jahr
```{r}


extractedTable_Postgre$month = month(extractedTable_Postgre$timestamp)
extractedTable_Postgre$year = year(extractedTable_Postgre$timestamp)

```

Erneutes aufsummieren der Commits pro Monat
```{r}

extractedTableMonth_Postgre <- extractedTable_Postgre %>%
  group_by(year,month) %>%
	summarise(commits = sum(commitCount))

```

Weiterer Plot als Monatsübersicht. 
```{r}

PostgrePlotMonthly <-ggplot(extractedTableMonth_Postgre, aes(y=commits,x=year,month)) +
  geom_smooth()

```
Hier kann man das Abfallen der Commitanzahl bereits besser erkennen
```{r}

PostgrePlotMonthly

```
Zum Abschluss noch eine Einzelauflistung der jeweiligen Jahre
```{r}

PostgrePlotMonthlyFacet <- ggplot(extractedTableMonth_Postgre, aes(y=commits,x=month)) +
      geom_bar(stat = "identity", fill = "darkorchid4") +
  facet_wrap(~ year, ncol = 5)

```
Auch hier mit der selben Erkenntnis
```{r}

PostgrePlotMonthlyFacet

```
# MySQL 
Die Einlese- und Bearbeitungsmethoden sind gleich 
```{r}

db_git_history_MySQL = load_db_history(input_path = "../../Workspace/MySQL.csv")
db_git_history_MySQL["timestamp"] = lapply(db_git_history_MySQL["timestamp"], function(x) as.Date(x, format='%Y-%m-%d'))


extractedTable_MySQL <- db_git_history_MySQL %>%
  group_by(timestamp) %>%
	summarise(commitCount = n_distinct(commit))


MySQLPlot <-ggplot(extractedTable_MySQL, aes(y=commitCount,x=timestamp)) + geom_line(color = "green") +stat_smooth(
  color = "#FC4E07", fill = "#FC4E07",
  method = "loess"
  )+ggtitle("Commit over Time") +
            xlab("Date") + ylab("CommitCount") + scale_x_date(limit=timeframe) 

```
Auch bei MySQL steigt zu beginn die Commitzahl an und fällt später wieder ab wobei hier insgesamt mehr Commits gemacht werden
```{r}

MySQLPlot


extractedTable_MySQL$month = month(extractedTable_MySQL$timestamp)
extractedTable_MySQL$year = year(extractedTable_MySQL$timestamp)
  
extractedTableMonth_MySQL <- extractedTable_MySQL %>%
  group_by(month,year) %>%
	summarise(commits = sum(commitCount))

MySQLPlotMonthly <-ggplot(extractedTableMonth_MySQL, aes(y=commits,x=year,month)) +
  geom_smooth()

```
MySQL macht ca doppelt so viel Commits im Manat zur Spitzenzeit
```{r}

MySQLPlotMonthly


MySQLPlotMonthlyFacet <- ggplot(extractedTableMonth_MySQL, aes(y=commits,x=month)) +
      geom_bar(stat = "identity", fill = "darkorchid4") +
  facet_wrap(~ year, ncol = 5)

```
Auch hier lässt sich das Abfallen der Commits beobachten
```{r}

MySQLPlotMonthlyFacet

```

# Mongo 
```{r}
db_git_history_MongoDB = load_db_history(input_path = "../../Workspace/MongoDB.csv")
db_git_history_MongoDB["timestamp"] = lapply(db_git_history_MongoDB["timestamp"], function(x) as.Date(x, format='%Y-%m-%d'))

 
extractedTable_MongoDB <- db_git_history_MongoDB %>%
  group_by(timestamp) %>%
	summarise(commitCount = n_distinct(commit))



MongoDB <-ggplot(extractedTable_MongoDB, aes(y=commitCount,x=timestamp)) + geom_line(color = "green") +stat_smooth(
  color = "#FC4E07", fill = "#FC4E07",
  method = "loess"
  )+ggtitle("Commit over Time") +
            xlab("Date") + ylab("CommitCount") + scale_x_date(limit=timeframe) 

```
Bei MongoDb anders als bei den anderen steigt nach einer kurzen abnahme die Commitanzahl leicht bis heute
```{r}

MongoDB


extractedTable_MongoDB$month = month(extractedTable_MongoDB$timestamp)
extractedTable_MongoDB$year = year(extractedTable_MongoDB$timestamp)
  
extractedTableMonth_MongoDB <- extractedTable_MongoDB %>%
  group_by(month,year) %>%
	summarise(commits = sum(commitCount))



MongoDBPlotMonthly <-ggplot(extractedTableMonth_MongoDB, aes(y=commits,x=year,month)) +
  geom_smooth()

```
Die Spitze ist ähnlich hoch wie bei MySQL
```{r}

MongoDBPlotMonthly

MongoDBPlotMonthlyFacet <- ggplot(extractedTableMonth_MongoDB, aes(y=commits,x=month)) +
      geom_bar(stat = "identity", fill = "darkorchid4") +
  facet_wrap(~ year, ncol = 5)

```
Die Spitze lässt sich hier nur schwer erkennen
```{r}

MongoDBPlotMonthlyFacet

```

